{
  "id": 3282,
  "date": "2017-01-24T15:30:55",
  "date_gmt": "2017-01-24T15:30:55",
  "guid": {
    "rendered": "http://ronvalstar.nl/?p=3282"
  },
  "modified": "2017-01-24T17:49:30",
  "modified_gmt": "2017-01-24T17:49:30",
  "slug": "experiment-fire",
  "status": "publish",
  "type": "post",
  "link": "https://ronvalstar.nl/experiment-fire",
  "title": {
    "rendered": "Experiment: procedural fire with sparks in glsl"
  },
  "content": {
    "rendered": "<p>Here&#8217;s a hot shader: fire with sparks. The fire is <a href=\"#code-36\" to=\"#code-47\"> Simplex noise</a>, nothing special apart from some displacement to fake realism. But the sparks might need some explanation.<br />\n<!--more--><br />\nThe shader is entirely procedural. So the sparks flying upward are calculated for each pixel. We could calculate the sparks in advance as particles and put them into the shader by uniform. But there&#8217;s no fun in that.<br />\nThe technique I wanted to implement here is similar to one I previously used in plain Javascript in <a href=\"/experiment-snow\">an earlier experiment</a>.</p>\n<h2>A grid, a prng and some trigonometry</h2>\n<p>The gist of it is as follows: calculate a grid, feed the grid positions into a pseudo random number generator (prng), use the random number to rotate a particle inside the grid.<br />\nCompared to <a href=\"/experiment-snow\">the snow experiment</a> the mental approach is a bit like coding it the other way around (we don&#8217;t really displace particles, we displace the input variables). Plus we cannot exceed the grid boundaries (we&#8217;re calculating pixels, not particles). If you click without dragging you will see the displaced grid. Notice the sparks are moving in circles within each grid cell.</p>\n<p>First we create a grid. To do that we use modulo grid-size on the xy position: <code>mod(gl_FragCoord,40.0)</code>, <a href=\"#code-68\">line 68</a>. This will give us a grid of linear gradients (from zero to one) that we can use to create a spherical gradient.<br />\nIf you change the very last line to: <code>gl_FragColor = vec4(mod(gl_FragCoord,40.0)/40.0,0.0,1.0);</code> you&#8217;ll see a pattern like this. The green and red are going from zero to one every 40 pixels.</p>\n<p><img src=\"/wordpress/wp-content/uploads/gridmodulus.png\" alt=\"modulo grid\" width=\"199\" height=\"159\" class=\"alignnone size-full wp-image-3189\" /></p>\n<p>The axes are divided by the size of the grid and floored to get the seeds for the random number. So the coordinates for the bottom left grid cell become 0,0 (the default origin for gl_FragCoord is the bottom left corner). Defining the grid index is done <a href=\"#code-63\">here</a>.<br />\nAgain a simple example: <code>gl_FragColor = vec4(floor(gl_FragCoord.x/40.0)/4.0,floor(gl_FragCoord.y/40.0)/3.0,0.0,1.0);</code> makes this:</p>\n<p><img src=\"/wordpress/wp-content/uploads/gridfloored.png\" alt=\"grid indices\" width=\"200\" height=\"160\" class=\"alignnone size-full wp-image-3194\" /></p>\n<p>The floored indices are the numbers we&#8217;ll use as input for our prng. The prng we&#8217;ll be using is <a href=\"https://www.shadertoy.com/view/4djSRW\">one by David Hoskins</a> who says: <q>The magic numbers were chosen by mashing the number pad, until it looked OK!</q>. Haha, well fractional parts beats LCG and Mersenne Twister in this case.<br />\nThis gets us the following <code>gl_FragColor = vec4(prng(floor(gl_FragCoord.xy/40.0)),0.0,0.0,1.0);</code>:</p>\n<p><img src=\"/wordpress/wp-content/uploads/gridrng.png\" alt=\"random grid indices\" width=\"200\" height=\"160\" class=\"alignnone size-full wp-image-3196\" /></p>\n<h2>Let there be sparks</h2>\n<p>This random number is used to <a href=\"#code-68\">define the size</a> of the spark as well as <a href=\"#code-69\" to=\"#code-72\">it&#8217;s rotation</a> and it&#8217;s <a href=\"#code-65\">life expectancy</a>. The input derived from <code>gl_FragCoord</code> is also <a href=\"#code-59\" to=\"#code-61\">displaced around a bit</a> to create some flow direction and randomness.</p>\n<p>And that is really all there is to it.<br />\nThe source code is below. I&#8217;ve also <a href=\"https://www.shadertoy.com/view/MlKSWm\" target=\"_blank\">ported this over to Shadertoy</a> (with minor some adjustments to get it working there) so you can easily tweak and/or fork it.</p>\n<pre line-numbers><code data-language=\"glsl\" data-src=\"/static/glsl/fire.glsl\"></code></pre>\n",
    "protected": false
  },
  "excerpt": {
    "rendered": "<p>Here&#8217;s a hot shader: fire with sparks. The fire is Simplex noise, nothing special apart from some displacement to fake realism. But the sparks might need some explanation.</p>\n",
    "protected": false
  },
  "author": 2,
  "featured_media": 3285,
  "comment_status": "open",
  "ping_status": "open",
  "sticky": false,
  "template": "",
  "format": "standard",
  "meta": [],
  "categories": [
    5,
    304
  ],
  "tags": [
    235,
    236,
    297,
    305,
    306,
    307
  ],
  "terms": {
    "post_tag": [
      {
        "term_id": 235,
        "name": "cool shit",
        "slug": "cool-shit",
        "term_group": 0,
        "term_taxonomy_id": 254,
        "taxonomy": "post_tag",
        "description": "",
        "parent": 0,
        "count": 24,
        "filter": "raw",
        "term_order": "0",
        "ID": 235
      },
      {
        "term_id": 236,
        "name": "noise",
        "slug": "noise",
        "term_group": 0,
        "term_taxonomy_id": 255,
        "taxonomy": "post_tag",
        "description": "",
        "parent": 0,
        "count": 2,
        "filter": "raw",
        "term_order": "0",
        "ID": 236
      },
      {
        "term_id": 297,
        "name": "webgl",
        "slug": "webgl",
        "term_group": 0,
        "term_taxonomy_id": 301,
        "taxonomy": "post_tag",
        "description": "",
        "parent": 0,
        "count": 6,
        "filter": "raw",
        "term_order": "0",
        "ID": 297
      },
      {
        "term_id": 305,
        "name": "glsl",
        "slug": "glsl",
        "term_group": 0,
        "term_taxonomy_id": 309,
        "taxonomy": "post_tag",
        "description": "",
        "parent": 0,
        "count": 2,
        "filter": "raw",
        "term_order": "0",
        "ID": 305
      },
      {
        "term_id": 306,
        "name": "fire",
        "slug": "fire",
        "term_group": 0,
        "term_taxonomy_id": 310,
        "taxonomy": "post_tag",
        "description": "",
        "parent": 0,
        "count": 1,
        "filter": "raw",
        "term_order": "0",
        "ID": 306
      },
      {
        "term_id": 307,
        "name": "shader",
        "slug": "shader",
        "term_group": 0,
        "term_taxonomy_id": 311,
        "taxonomy": "post_tag",
        "description": "",
        "parent": 0,
        "count": 2,
        "filter": "raw",
        "term_order": "0",
        "ID": 307
      }
    ],
    "category": [
      {
        "term_id": 5,
        "name": "code",
        "slug": "code",
        "term_group": 0,
        "term_taxonomy_id": 5,
        "taxonomy": "category",
        "description": "",
        "parent": 170,
        "count": 71,
        "filter": "raw",
        "term_order": "0",
        "ID": 5
      },
      {
        "term_id": 304,
        "name": "glsl",
        "slug": "glsl",
        "term_group": 0,
        "term_taxonomy_id": 308,
        "taxonomy": "category",
        "description": "",
        "parent": 5,
        "count": 3,
        "filter": "raw",
        "term_order": "0",
        "ID": 304
      }
    ]
  },
  "_links": {
    "self": [
      {
        "href": "https://ronvalstar.nl/api/wp/v2/posts/3282"
      }
    ],
    "collection": [
      {
        "href": "https://ronvalstar.nl/api/wp/v2/posts"
      }
    ],
    "about": [
      {
        "href": "https://ronvalstar.nl/api/wp/v2/types/post"
      }
    ],
    "author": [
      {
        "embeddable": true,
        "href": "https://ronvalstar.nl/api/wp/v2/users/2"
      }
    ],
    "replies": [
      {
        "embeddable": true,
        "href": "https://ronvalstar.nl/api/wp/v2/comments?post=3282"
      }
    ],
    "version-history": [
      {
        "count": 22,
        "href": "https://ronvalstar.nl/api/wp/v2/posts/3282/revisions"
      }
    ],
    "predecessor-version": [
      {
        "id": 3335,
        "href": "https://ronvalstar.nl/api/wp/v2/posts/3282/revisions/3335"
      }
    ],
    "wp:featuredmedia": [
      {
        "embeddable": true,
        "href": "https://ronvalstar.nl/api/wp/v2/media/3285"
      }
    ],
    "wp:attachment": [
      {
        "href": "https://ronvalstar.nl/api/wp/v2/media?parent=3282"
      }
    ],
    "wp:term": [
      {
        "taxonomy": "category",
        "embeddable": true,
        "href": "https://ronvalstar.nl/api/wp/v2/categories?post=3282"
      },
      {
        "taxonomy": "post_tag",
        "embeddable": true,
        "href": "https://ronvalstar.nl/api/wp/v2/tags?post=3282"
      }
    ],
    "curies": [
      {
        "name": "wp",
        "href": "https://api.w.org/{rel}",
        "templated": true
      }
    ]
  }
}